#Surge 5 by oiozi 20240201
#log：
#自建第一版融合[I&M]....Done
#自建第二版融合[I&M]....Done
# ------------------
# 下载配置后，需要自行添加机场订阅链接
# 此处推荐使用Sub-Store订阅链接，多机场用户可以将多个机场订阅整合为一个Sub-Store订阅
# Surge MAC：
# 显示主窗口 - 策略 - 右键编辑"PROXY"策略组 - 选择"可选策略组"下一步 - 更换“同时包含外部策略”对话框中的链接为你自己的Sub-Store订阅链接或机场订阅链接；
# Surge iOS
# 首页 - “出站模式”模块下选择“代理服务器” - 选择“PROXY”策略组 - 下拉到底部“外部代理列表” - 更换其中的链接为你自己的Sub-Store订阅链接或机场订阅链接；

# 通用设置
[General]
# ================ IOS & MacOS共存参数 ================ #
# > 网络设置
#连接测试[网络 & 代理]
internet-test-url = http://cp.cloudflare.com/generate_204
proxy-test-url = http://cp.cloudflare.com/generate_204
test-timeout = 3

# > IPv6支持[启用完整的IPv6支持 开启该选项后域名会查询AAAA记录即使未启用也可以通过直接访问IPv6地址来访问单栈站点]
ipv6 = true
# > 允许 IPv6 通过 Surge VIF。当您希望 Surge 处理连接到 IPv6 地址的原始 TCP 连接时很有用。
# > off ：切勿使用 IPv6 设置 Surge VIF
# > auto ：仅当本地网络具有有效的 IPv6 网络时，才使用 IPv6 设置 Surge VIF
# > always ：始终使用 IPv6 设置 Surge VIF
#ipv6-vif = false

# > 禁用GeoIP数据库的自动更新
disable-geoip-db-auto-update = false

# > 自定义GeoIP数据库
geoip-maxmind-url = https://raw.githubusercontent.com/JMVoid/ipip2mmdb/release/Country.mmdb

# > 日志级别[verbose, info, notify, or warning 不建议日常启用详细级别会导致性能降低]
loglevel = notify

# > DNS设置
# > 劫持DNS[劫持所有DNS查询]
hijack-dns = *:53

# > DNS服务器[上游DNS服务器的IP地址 不建议使用DNS over HTTPS]
dns-server = system, 119.29.29.29, 119.28.28.28, 223.5.5.5, 223.6.6.6, 1.2.4.8, 8.8.8.8
#doh-server = https://223.5.5.5/dns-query, https://1.12.12.12/dns-query, https://8.8.8.8/dns-query, https://1.1.1.1/dns-query

# > 加密DNS跟随出站模式[开启后DOH将遵循出站模式设置和规则并查找使用直接出站]
#encrypted-dns-follow-outbound-mode = true

# > 加密的DNS服务器[配置加密DNS后传统DNS将仅用于测试连接并解析加密DNS URL中的域]
#encrypted-dns-server = https://223.5.5.5/dns-query,quic://223.6.6.6:853,quic://223.5.5.5:853,https://223.6.6.6/dns-query,https://1.12.12.12/dns-query,https://120.53.53.53/dns-query

# > 跳过加密的DNS服务器证书验证[这是不安全的]
#encrypted-dns-skip-cert-verification = false

# > 使用本地主机代理[开启后始终在远程服务器上执行DNS查找,当存在目标域的本地DNS映射结果则会使用IP地址而不是域来设置代理连接]
use-local-host-item-for-proxy = false

# > SVCB至DNS记录查找[默认禁止SVCB记录查找因为非标准A记录查找会导致Surge无法返回虚拟IP地址]
allow-dns-svcb = false

# > TCP/UDP设置
# > 强制使用HTTP请求头[将TCP连接当作HTTP请求并让HTTP引擎来处理 支持所有的高级功能]
force-http-engine-hosts = *.ott.cibntv.

# > 总是嗅探TCP主机[自动嗅探发送到80/443的TCP请求协议,优化性能的同时开启高级HTTP/HTTPS功能但是会产生兼容性问题但可以添加主机名排除]
always-raw-tcp-hosts = *.baidu.com

# > UDP策略不支持行为[当代理服务器不支持UDP转发需修改位直连或注释,注意同目标主机名的tcp/udp请求源地址不同会造成隐私及安全泄露问题]
udp-policy-not-supported-behaviour = REJECT

# > UDP代理测试[代理的默认UDP测试参数]
# proxy-test-udp = apple.com@8.8.8.8

# > UDP优先级[外号:游戏模式,当系统负载非常高且数据包处理延迟时自启优先处理UDP数据包。]
udp-priority = false

# > 面板设置
# > 外部控制器[允许外部控制器控制Surge或Surge CI进行控制管理macOS:Surge Dashboard & iOS:Surge iOS遥控器]
external-controller-access = password@127.0.0.1:6170

# > 远程控制器认证[可以让另一个App或者设备通过HTTP API控制Surge功能]
http-api = password@127.0.0.1:6166

# > 远程控制器开关[使用HTTPS协议需要配置 MitM CA 证书]
http-api-tls = false

# > 远程面板控制器开关
http-api-web-dashboard = false

# > 拒绝策略显示页面[当纯HTTP请求时则显示拒绝策略的错误页]
show-error-page-for-reject = true

# > TUN路由排除[开启后可绕过特地IP范围并且允许所有流量通过,合并跳过代理并确保TUN路由排除特定HTTP流量绕过Surge,仅适用于Surge VIF而Surge Proxy Server处理的请求不受影响]
# tun-excluded-routes =

# > 包含TUN路由[在WI-FI接口较小时开启此项可添加较小的路由]
# tun-included-routes =

# > 始终真IP[当Surge VIF处理DNS问题时要求Surge返回真实IP地址而不是虚假IP地址，DNS数据包将被转发到上游DNS服务器此参数属于主机列表类型]
# > [前缀 - 排除主机名][支持通配符 * 和 ?][后缀 :port 匹配其他端口,未提供端口号时自动附加,仅配置主机名时则仅对端口80生效,对于MITM功能它仅对端口443有效][后缀 :0 以匹配所有端口][使用<ip-address> 直接使用 IPv4/IPv6 地址（而不是域）匹配所有主机名]
always-real-ip = *.msftconnecttest.com, *.msftncsi.com, *.srv.nintendo.net, *.stun.playstation.net, xbox.*.microsoft.com, *.xboxlive.com, *.logon.battlenet.com.cn, *.logon.battle.net, stun.l.google.com

# > 跳过代理
#[iOS:此选项强制与这些域/IP 范围的连接由 Surge VIF 而不是 Surge 代理处理。]
#[macOS:当启用“设置为系统代理”时，这些设置将应用于系统。此选项用于修复某些应用的兼容性问题。]
#注意：如果输入 IP 地址或地址范围，则只有在使用该地址连接到该主机时才能绕过代理，而不能在通过解析为该地址的域名连接到主机时绕过代理。
skip-proxy = localhost, *.local, 0.0.0.0/8, 10.0.0.0/8, 17.0.0.0/8, 100.64.0.0/10, 127.0.0.0/8, 169.254.0.0/16, 172.16.0.0/12, 192.0.0.0/24, 192.168.0.0/16, 193.168.0.1/32, 192.168.122.1/32, 224.0.0.0/4, 240.0.0.0/4, 255.255.255.255/32, *.crashlytics.com, passenger.t3go.cn, captive.apple.com, seed-sequoia.siri.apple.com, sequoia.apple.com, injections.adguard.org, local.adguard.org, apple.com, *apple.com

# > 排除简单主机名[就像 skip-proxy 参数一样。此选项允许请求使用由 Surge VIF 而不是 Surge 代理处理的简单主机名（不带点）]
# > mysql01、redis01
exclude-simple-hostnames = 

# ================ 仅限IOS参数 ================ #
# > 网络设置
# > 隐藏VPN图标
hide-vpn-icon = false

# > 兼容性模式[用于控制Surge iOS的工作模式:0=自动 1=代理接管 + VIF(代理优先级高性能强) 2=仅代理接管 3=仅接管VIF(新版默认模式) 4=代理接管 + VIF(使用VIF地址非回环) 5=代理接管+VIF(绕过特殊问题)]
compatibility-mode = 3

# > WiFi助理[在Wi-Fi网络不佳时尝试使用数据网络建立连接]
wifi-assist = false

# > WiFi访问[允许局域网设备访问Surge]
# >> iOS[开启改为true]
allow-wifi-access = false
wifi-access-http-port = 6152
wifi-access-socks5-port = 6153
wifi-access-http-auth = username:password

# > 混合网络[始终启用Wi-Fi & 蜂窝数据连接此功能将应用于所有TCP连接和DNS查找]
all-hybrid = false

# > 允许热点访问[支持其他设备访问代理服务]
allow-hotspot-access = ture

# > 包含所有网络[开启后所有请求都由 Surge 处理而不会泄漏但会导致其它等无法正常工作以及意外的副作用,默认关闭]
include-all-networks = false

# > 包含本地网络[开启后Surge VIF 处理将发送到LAN的请求但会导致其它等无法正常工作以及意外的副作用,默认关闭且必须与include-all-networks=true结合使用]
include-local-networks = false

# > 包含苹果推送通知服务[开启后Surge VIF 处理苹果推送通知服务的网络流量且必须与include-all-networks=true结合使用]
include-apns = false

# > 包含蜂窝服务[开启后Surge VIF 处理蜂窝服务的Internet可路由网络流量,但某些被排除在隧道之外的蜂窝运营商会绕过互联网将流量直接路由到运营商网络且必须与include-all-networks=true结合使用]
include-cellular-services = false

# ================ 仅限MacOS参数 ================ #
# > 网络设置
# > vif模式[auto=自动选择最合适的工作模式 v1=传统模式TCP协议栈完全由Surge管理 v2=提高性能但无法与虚拟机网络共享兼容 v3=性能略低于v2但无v2的短板]
#vif-mode = v3
#
# > 读取HOSTS表
#read-etc-hosts = true
#
# > HTTP代理服务
#http-listen = 0.0.0.0
#
# > SOCKS5代理服务
##socks5-listen = 0.0.0.0
#
# > 如果wifi不是主要的，则使用默认策略[禁用后即使Wi-Fi不是主网络接口但SSID/BSSID 模式仍可匹配]
#use-default-policy-if-wifi-not-primary = false
#
# > CPU调试模式[可能会降低性能]
#debug-cpu-usage = false
#
# > 内存调试模式[可能会降低性能]
#debug-memory-usage = false

# ================ 未知共存参数 ================ #
# > Network framwork[实验性功能：您可以启用 Network.framework 以利用用户空间网络堆栈，这可以提高吞吐量、减少延迟并启用多路径 TCP 等尖端功能。]
network-framework = false

# > 抓取流量过滤/复写[0=关闭1=开启]
[Replica]
# > 隐藏所有发往.Apple.com和.icloud.com的请求
hide-apple-request = 0

# > 隐藏崩溃追踪器(Crashlytics)请求
hide-crash-reporter-request = 1

# > 隐藏 UDP 会话
hide-udp = 0

# > 关键词过滤器[none=关闭关键词过滤器 whitelist=仅记录包含关键字的请求 blacklist=仅记录不包含关键字的请求 pattern=匹配通配符的请求]
keyword-filter-type = none

# > 关键词
keyword-filter = (null)

#!include(包括)对应段的[]声明，引用另一个文件既可以是一个只包含部分段的文件（一个或多个），也可以是一个完整的配置。
[Proxy]
#!include

#未知共存部分[间隔 [超时/容忍] 隐藏]
[Proxy Group]
手动选择 = select, include-all-proxies=1, policy-regex-filter=^((?!佣金|官网|免翻|到期|流量|更新|点外|重置|免流|TG@REBIRTHOKAY|网易|音乐|DIRECT|GB|Days|Date|Expire|Premium).)*$
网易音乐 = select, include-all-proxies=1, policy-regex-filter=^(?=.*(REBIRTHOKAY|网易云|音乐|数值|(?i)Music))^((?!(台|日|韩|新|美|香|加)).)*$
国内媒体 = select, include-all-proxies=1, DIRECT, 手动选择
国际媒体 = select, include-all-proxies=1, 香港节点, 手动选择, 台湾节点, 日本节点, 狮城节点, 美国节点, DIRECT
电报服务 = select, include-all-proxies=1, 手动选择, 香港节点, 台湾节点, 日本节点, 狮城节点, 美国节点, DIRECT
谷歌服务 = select, include-all-proxies=1, 美国节点, 手动选择
全球加速 = select, include-all-proxies=1, 香港节点, 手动选择, 台湾节点, 日本节点, 狮城节点, 美国节点,
黑白名单 = select, include-all-proxies=1, DIRECT, 手动选择, 香港节点, 台湾节点, 日本节点, 狮城节点, 美国节点
香港节点 = url-test, include-all-proxies=1, policy-regex-filter=(?=.*(港|HK|(?i)Hong))^((?!(台|日|韩|新|美|Game|游戏|打機|Test|Burst)).)*$, interval=600, timeout=3, tolerance=50, hidden=true
台湾节点 = url-test, include-all-proxies=1, policy-regex-filter=(?=.*(台|TW|(?i)Taiwan))^((?!(港|日|韩|新|美|Game|游戏|Test)).)*$, interval=600, timeout=3, tolerance=50, hidden=true
日本节点 = url-test, include-all-proxies=1, policy-regex-filter=(?=.*(日|JP|(?i)Japan))^((?!(港|台|韩|新|美|Game|游戏)).)*$, interval=600, timeout=3, tolerance=50, hidden=true
狮城节点 = url-test, include-all-proxies=1, policy-regex-filter=(?=.*(新|狮|獅|SG|(?i)Singapore))^((?!(港|台|日|韩|美|Game|游戏)).)*$, interval=600, timeout=3, tolerance=50, hidden=true
美国节点 = url-test, include-all-proxies=1, policy-regex-filter=(?=.*(美|US|(?i)States|American))^((?!(港|台|日|韩|新|Game|游戏|Test|专线|解锁|Burs|CN|BGP|free)).)*$, interval=600, timeout=3, tolerance=50, hidden=true
屏蔽垃圾 = select, REJECT
国内直连 = select, DIRECT

[Rule]
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Advertising/Advertising_All_No_Resolve.list,屏蔽垃圾,update-interval=86400,no-resolve // AD广告
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Hijacking/Hijacking.list,屏蔽垃圾,update-interval=86400 // 防劫持
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/BlockHttpDNS/BlockHttpDNS.list,屏蔽垃圾,update-interval=86400 // 禁用HTTP协议的DNS
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Privacy/Privacy_All_No_Resolve.list,屏蔽垃圾,update-interval=86400 // 隐私保护
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Lan/Lan.list,国内直连,update-interval=86400 // Lan网
RULE-SET,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/LocalAreaNetwork.list,国内直连,update-interval=86400 // 私有网
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/AmazonCN/AmazonCN.list,国内直连,update-interval=86400 // 亚马逊中国
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Cloudflarecn/Cloudflarecn.list,国内直连,update-interval=86400 // Cloudflare中国
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Download/Download.list,国内直连,update-interval=86400 // 下载网站
RULE-SET,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/UnBan.list,国内直连,update-interval=86400 // 白名单
RULE-SET,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/GoogleCN.list,国内直连,update-interval=86400 // 谷歌中国
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/OneDrive/OneDrive.list,国内直连,update-interval=86400 // Microsoft OneDrive
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Microsoft/Microsoft.list,国内直连,update-interval=86400 // Microsoft服务
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Amazon/Amazon.list,国内直连,update-interval=86400 // 亚马逊网站
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/AmazonIP/AmazonIP.list,国内直连,update-interval=86400 // 亚马逊服务器
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Jetbrains/Jetbrains.list,国内直连,update-interval=86400 // Jetbrains
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Apple/Apple_All_No_Resolve.list,国内直连,update-interval=86400 // Apple
RULE-SET,https://raw.githubusercontent.com/Coldvvater/Mononoke/master/Surge/Rules/Telegram.list,电报服务,update-interval=86400 // Telegram
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Twitter/Twitter.list,美国节点,update-interval=86400 // Twitter
RULE-SET,https://raw.githubusercontent.com/Coldvvater/Mononoke/master/Surge/Rules/AI.list,美国节点,update-interval=86400 // ChatGPT
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/GitHub/GitHub.list,美国节点,update-interval=86400 // Github
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Cloudflare/Cloudflare.list,美国节点,update-interval=86400 // Cloudflare
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/YouTube/YouTube.list,国际媒体,update-interval=86400 // YouTube
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/YouTubeMusic/YouTubeMusic.list,国际媒体,update-interval=86400 // YouTube Music
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Netflix/Netflix.list,国际媒体,update-interval=86400 // Netflix
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/TikTok/TikTok.list,国际媒体,update-interval=86400 // TikTok
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Disney/Disney.list,国际媒体,update-interval=86400 // Disney
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/GlobalMedia/GlobalMedia_All_No_Resolve.list,国际媒体,update-interval=86400 // 国外媒体
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Proxy/Proxy_All_No_Resolve.list,全球加速,update-interval=86400 // GFW
RULE-SET,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/ChinaCompanyIp.list,国内直连,update-interval=86400 // 中国公司IP
RULE-SET,https://raw.githubusercontent.com/chenyk1219/surge/release/ChinaDomain.list,国内直连,update-interval=86400 // 中国域名
GEOIP,CN,国内直连 // 中国IP
FINAL,黑白名单

[URL Rewrite]
^https?://(www.)?g.cn https://www.google.com 302
^https?://(www.)?google.cn https://www.google.com 302